概要
====

VMware の共有フォルダ機能を使用して、ホスト・ゲスト間でファイルの交換を
行う、FTP クライアント風のファイル転送プログラムです。当然のことながら、
共有フォルダ機能をサポートする VMware プロダクトが必要です
(Workstation 4.0 以降？).

プログラム起動時のコマンドラインパラメータはありません。

起動されると、コマンドインタープリタ（というほど大それたものではありません
が）に入り、ユーザ入力を待ちます。ユーザ入力を待っている時には、"vmftp>"
プロンプトが表示されます。


コマンド
========

以下のコマンドが使用可能です：

! [<command>]

    <command> をシェルコマンドとしてゲスト内で実行します。
    <command> が省略された場合、対話型シェルを起動します。


? [<command>]

    vmftp コマンド <command> の意味を表示します。
    <command> が省略された場合、使用可能なコマンドの一覧を表示します。
    コマンド名は、他のコマンドと一意に区別できる範囲で省略可能です。


bye, quit

    vmftp セッションを終了し、プログラムを終了します。
    プロンプトで EOF が検出された場合も同様にセッションを終了します。


cd [<host-dir>]

    ホストマシンでのワーキングディレクトリを <host-dir> に変更します。
    ディレクトリが省略された場合、共有フォルダルートがワーキングディレクト
    リとなります。

    <host-dir> は、目的とするディレクトリをフルパスまたは相対パスで指定し
    ます。ワイルドカード (* および ?) は展開されません。

    ホストワーキングディレクトリは初期状態では共有フォルダルートです。

    SEE ALSO:
        pwd コマンド - ホストワーキングディレクトリを表示します
        lcd コマンド - ゲストワーキングディレクトリを変更します


chmod <mode> <host-file>

    ホスト上のファイル <host-file> のパーミッションを変更します。

    <mode> には以下のひとつを指定します
      '+r' 読み取り許可
      '-r' 読み取り禁止
      '+w' 書き込み許可
      '-w' 書き込み禁止
      '+x' 実行許可
      '-x' 実行禁止
    二つ以上の組み合わせや、unix 形式の８進数値 (例：644) は使用不可です。

    Windows ホストでは 'r' および 'x' のモードは効果をもちません（読み取り
    および実行は常に許可となります）。

    Linux ホストでは、このコマンドが変更するのは所有者パーミッションです。
    またこのコマンドは同時にグループおよびゲストパーミッションを全て禁止に
    してしまいます。

    <host-file> は、目的とするファイルをフルパスまたは相対パスで指定しま
    す。ワイルドカード (* および ?) は展開されません。

    註: ゲスト上のファイルのパーミッションを変更するにはシェルコマンドを
        使用します：
          例："!attrib +r guestfile" DOS/WIN
              "!chmod -r guestfile" unix


debug

   デバッグモードを切り替えます。デバッグ有効の場合、共有フォルダファンク
   ション実行時のパラメータとステータスが全て表示されます。


delete <host-file>

    ホスト上のファイル <host-file> を削除します。

    <host-file> は、目的とするファイルをフルパスまたは相対パスで指定しま
    す。ワイルドカード (* および ?) は展開されません。

    註：ゲスト上のファイルを削除するにはシェルコマンドを使用します：
        例："!del guestfile" DOS/WIN
            "!rm guestfile" unix

    SEE ALSO:
        rmdir コマンド - ホスト上のディレクトリを削除します


get <host-path> [<guest-name>]

    <host-path> で指定されるホスト上のファイルまたはディレクトリを取得し、
    ゲスト上のディスクに保存します。<guest-name> が省略された場合、ホスト
    上での名称が使用されます。

    同じ名称のファイルがゲスト上に存在する場合、無条件で上書きされます。

    <host-path> は、目的とするファイルまたはディレクトリをフルパスまたは
    相対パスで指定します。ワイルドカード (* および ?) は展開されますが、
    サブディレクトリは合致リストから除外されます。

    <guest-name> は、ゲスト内での名称をフルパスまたは相対パスで指定しま
    す。ワイルドカード (* および ?) は展開されません。

    ファイルはバイナリデータとして転送され、テキスト変換などは一切行われ
    ません（FTP のバイナリモードのようなものです）。


lcd [<guest-dir>]

    ゲストマシンでのワーキングディレクトリを <guest-dir> に変更します。
    対象ディレクトリが指定されなかった場合、ユーザのホームディレクトリが
    ワーキングディレクトリとなります。

    <guest-dir> は、目的とするディレクトリをフルパスまたは相対パスで指定
    します。ワイルドカード (* および ?) は展開されません。

    ゲストワーキングディレクトリは、初期状態では vmftp プログラム起動時の
    ワーキングディレクトリです。

    NOTE: シェル内で実行された cd コマンド (例：vmftp> !cd /) は、その
        シェルプロセス内でのみ効果をもちます。

    NOTE: ゲストワーキングディレクトリを表示するにはシェルコマンドを使用し
        ます：
        例："!cd" DOS/WIN
            "!pwd" unix

    SEE ALSO:
        cd コマンド - ホストワーキングディレクトリを変更します


ls [<host-dir>]

    ホストマシンのディレクトリ内容の一覧を表示します。
    <host-dir> が省略された場合、ワーキングディレクトリが使用されます。

    <host-dir> は、目的とするディレクトリをフルパスまたは相対パスで指定
    します。ワイルドカード (* および ?) は展開されません。

    Linux ホストでは、このコマンドで表示されるファイルのパーミッションは
    所有者パーミッションです。

    DOS ゲストおよび一部の unix 系ゲストでは、TZ 環境変数が正しく設定され
    ていないと、ファイルの日付を正しく表示することができません。

    NOTE: ゲスト上のディレクトリの内容を表示するにはシェルコマンドを使用し
        ます：
        例："!dir" DOS/WIN
            "!ls -l" unix


mkdir <host-dir>

    ホストマシン上にディレクトリを作成します。

    <host-dir> は、目的とするディレクトリをフルパスまたは相対パスで指定
    します。ワイルドカード (* および ?) は展開されません。

    NOTE: ゲスト上にディレクトリを作成するにはシェルコマンドを使用します：
        例："!mkdir guestdir"


put <guest-path> [<host-name>]

    <guest-path> で指定されるファイルまたはディレクトリを転送し、ホスト上
    に保存します。
    <host-name> が省略された場合、ゲスト内での名称が使用されます。

    同じ名称のファイルがホスト上に存在する場合、無条件で上書きされます。

    <guest-path> は、目的とするファイルまたはディレクトリをフルパスまたは
    相対パスで指定します。ワイルドカード (* および ?) は展開されますが、
    サブディレクトリは合致リストから除外されます。

    <host-name> は、ホスト上での名称をフルパスまたは相対パスで指定します。
    ワイルドカード (* および ?) は展開されません。

    ファイルはバイナリデータとして転送され、テキスト変換などは一切行われ
    ません（FTP のバイナリモードのようなものです）。


pwd

    ホストワーキングディレクトリを表示します。

    NOTE: ゲストワーキングディレクトリを表示するにはシェルコマンドを使用
        します。
        例："!cd" DOS/WIN
            "!pwd" on unix


rename <host-file> <new-name>

    ホスト上のファイル <host-file> の名称を <new-name> に変更します。

    <host-file> は、目的とするファイルをフルパスまたは相対パスで指定しま
    す。

    <new-name> は、単一のファイル名称（パス区切りを含まない）で、ホストシ
    ステムのファイル名規則に則っている必要があります。

    ワイルドカード (* and ?) は、<host-file> <new-name> とも展開されませ
    ん。

    NOTE: ゲストファイルの名称を変更するにはシェルコマンドを使用します。
        例："!ren old new" DOS/WIN
            "!mv old new" unix


rmdir <host-dir>

    ホスト上のディレクトリを削除します。

    <host-dir> は、目的とするディレクトリをフルパスまたは相対パスで指定し
    ます。ワイルドカード (* および ?) は展開されません。

    対象ディレクトリは空でなければなりません。

    NOTE: ゲストディレクトリを削除するにはシェルコマンドを使用します。
        例："!rmdir guestdir"

    SEE ALSO:
        delete コマンド − ホスト上のファイルを削除します。


NOTES
=====

パスの指定

    ゲスト・ホストのオペレーティングシステムに関わらず、"/" と "\" の両方
    のパス区切りを使用することができます。

    特に制限されている場合を除き、フルパスと相対パスの両方を使用することが
    できます。

    フルパスとはルートを起点とするパスで、"/" または "\" (または DOS/WIN
    ゲストの場合 "x:\") で始まります。ゲスト内でのルートはゲストのファイル
    システムのルートです。ホスト内でのルートは、仮想マシンに設定された共有
    フォルダ全てを取りまとめる概念上のノードです。

    相対パスとは、現在のワーキングディレクトリを起点とするパスです。

    "." (現在のディレクトリ) および ".." (親ディレクトリ) の記述も使用可能
    です。

    ホスト上のパスでは大小文字は区別されます。

    ゲスト上のパスでの大小文字の区別は、ゲストオペレーティングシステムに
    よります。


複数ファイルの転送

    転送元パスにワイルドカード文字を使用する、あるいは転送元パスにディレク
    トリ名称を指定することによって、複数のファイルをまとめて転送することが
    できます。

    ディレクトリ名称を指定した場合、確認のプロンプトを表示した後、該当ディ
    レクトリの内容およびサブディレクトリの内容を再帰的に転送します。
    同じ名称のファイルが転送先に存在した場合、無条件で上書きされます。
    同じ名称のディレクトリが転送先に存在した場合、エラーで中断します。

    転送元パスにワイルドカード文字を使用した場合、パターンマッチングを行い
    合致するファイルを全て転送します。この場合確認のプロンプトは表示されま
    せん。ディレクトリはパターンマッチングから除外され、サブディレクトリに
    降りて行くことはしません。
    このプログラムのパターンマッチングはあまり賢くないので、あまり複雑な表
    記は避けたほうがよいでしょう。

    これらの場合、転送先での名称を指定することはできません。全てのファイル
    が同じ名称を使うことになってしまい、最後のファイルで上書きされてしまい
    ます。

    例：
       "hostdir" が、ホスト上のディレクトリ名である場合：

       "get hostdir" − このディレクトリの内容と、サブディレクトリの内容を
       再帰的に全て転送すします。

       "get hostdir/*" − このディレクトリ内のファイルを全て転送しますが、
       サブディレクトリには降りて行きません。


ファイル名の変換

    VMware の共有フォルダ機能は、ファイル名の非 ascii 文字に UTF-8 を使用
    します。このプログラムには、一応変換機能を組み込んでありますがあまり賢
    くないので、できるだけ非 ascii 文字を含むファイル名は避けたほうが良い
    でしょう。

    DOS: 非 ascii 文字は全て "_" に置き換えます。またホストからゲストへの
        転送時にはファイル名を 8.3 形式に切り詰めます。これらの変換の結果
        ファイル名の衝突が発生した場合、対象ファイルは無条件に上書きされま
        す。

    Windows: MultiByteToWideChar / WideCharToMultiByte Win32 API を使用し
        て UTF-8/ANSI 変換を行います。ただし、Windows にはこの変換の結果得
        られた文字が現在のシステムで表示可能かどうかを判断する手段がないた
        め、結局読めない文字になる可能性があります。たとえば、英語版
        Windows では通常は漢字の表示ができませんが、このようなシステムで漢
        字を含む UTF-8 テキストをローカルコードページに変換してもエラーと
        はなりません。

    Unix: iconv 関数が使用可能な場合、iconv を使用して UTF-8 とローカル
        コードセットの変換を行います。iconv が使用できない場合は、非 ascii
        文字を全て "_" に置き換えます。
